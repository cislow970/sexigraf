

<!doctype html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>vcsa_monitor.__main__ &#8212; VCSA REST API Monitoring stable 2.0.0 documentation</title>
    <link rel="stylesheet" href="../../_static/bizstyle.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <script type="text/javascript" src="../../_static/bizstyle.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <!--[if lt IE 9]>
    <script type="text/javascript" src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">VCSA REST API Monitoring stable 2.0.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for vcsa_monitor.__main__</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">:Description:</span>

<span class="sd">This robot uses the methods exposed by the Rest API to monitor the VCSA.</span>

<span class="sd">:Usage:</span>

<span class="sd">python -m vcsa_monitor [-h|--help] [-v|--vcsa &lt;FQDN VCSA&gt;] [-u|--username &lt;LOGIN USER&gt;] [-p|--password &lt;LOGIN PASSWORD&gt;] [-m|--method &lt;REST METHOD&gt;] [-f|--function &lt;METRIC FUNCTION&gt;] [-c|--checklist] [-s|--save &lt;BACKEND TYPE&gt;] [-d|--debug] [-l|--log] [-r|--release]</span>

<span class="sd">    optional arguments::</span>

<span class="sd">        -h, --help                                          show this help message and exit</span>
<span class="sd">        -v &lt;FQDN VCSA&gt;, --vcsa &lt;FQDN VCSA&gt;                  name of a specific vCenter (fqdn)</span>
<span class="sd">        -u &lt;LOGIN USER&gt;, --username &lt;LOGIN USER&gt;            username for login on rest api</span>
<span class="sd">        -p &lt;LOGIN PASSWORD&gt;, --password &lt;LOGIN PASSWORD&gt;    password for login on rest api (encoded base64)</span>
<span class="sd">        -m &lt;REST METHOD&gt;, --method &lt;REST METHOD&gt;            call a specific method of rest api</span>
<span class="sd">        -f &lt;METRIC FUNCTION&gt;, --function &lt;METRIC FUNCTION&gt;  set a specific metric function</span>
<span class="sd">        -c, --checklist                                     gets metrics in check list</span>
<span class="sd">        -s &lt;BACKEND TYPE&gt;, --save &lt;BACKEND TYPE&gt;            store data to InfluxDB or Graphite time series database</span>
<span class="sd">        -d, --debug                                         enable debug</span>
<span class="sd">        -l, --log                                           enable log</span>
<span class="sd">        -r, --release                                       show robot release and exit</span>

<span class="sd">    - allowed values for method:</span>

<span class="sd">        version, uptime, health_load, health_memory, health_storage, health_swap,</span>
<span class="sd">        health_system, health_softwarepackages, health_databasestorage, health_applmgmt, cpu_util,</span>
<span class="sd">        mem_usage, systemload, disk_latencyrate, disk_readrate, disk_writerate,</span>
<span class="sd">        rx_activity_eth0, rx_activity_eth1, rx_packetRate_eth0, rx_packetRate_eth1,</span>
<span class="sd">        rx_drop_eth0, rx_drop_eth1, rx_error_eth0, rx_error_eth1, tx_activity_eth0,</span>
<span class="sd">        tx_activity_eth1, tx_packetRate_eth0, tx_packetRate_eth1, tx_drop_eth0, tx_drop_eth1,</span>
<span class="sd">        tx_error_eth0, tx_error_eth1, fs_root, fs_swap, fs_boot, fs_core, fs_log, fs_db,</span>
<span class="sd">        fs_dblog, fs_seat, fs_archive, fs_updatemgr, fs_imagebuilder, fs_autodeploy,</span>
<span class="sd">        fs_netdump, fs_lifecycle, fs_vtsdb, fs_vtsdblog, content_library, backup_status, srvc_all,</span>
<span class="sd">        srvc_content-library, srvc_pschealth, srvc_vcha, srvc_vmware-vpostgres, srvc_vmware-postgres-archiver,</span>
<span class="sd">        srvc_vpxd, srvc_vsan-health, srvc_vsphere-client, srvc_vsphere-ui, available_updates,</span>
<span class="sd">        vcha_active_node, vcha_health_cluster</span>

<span class="sd">    - allowed values for function:</span>

<span class="sd">        MIN, AVG, MAX</span>

<span class="sd">    - allowed values for save:</span>

<span class="sd">        influxdb, graphite</span>

<span class="sd">      [Warning: only numeric metrics are supported saving on Graphite]</span>

<span class="sd">:Examples:</span>

<span class="sd">- Get version::</span>

<span class="sd">    python -m vcsa_monitor --vcsa vcenter.local.intranet --username &quot;monitor@vsphere.local&quot;</span>
<span class="sd">    --password &quot;xxxxxxxxxx&quot; --method &quot;version&quot;</span>

<span class="sd">- Get uptime::</span>

<span class="sd">    python -m vcsa_monitor --vcsa vcenter.local.intranet --username &quot;monitor@vsphere.local&quot;</span>
<span class="sd">    --password &quot;xxxxxxxxxx&quot; --method &quot;uptime&quot;</span>

<span class="sd">- Get health load::</span>

<span class="sd">    python -m vcsa_monitor --vcsa vcenter.local.intranet --username &quot;monitor@vsphere.local&quot;</span>
<span class="sd">    --password &quot;xxxxxxxxxx&quot; --method &quot;health_load&quot;</span>

<span class="sd">- Get health memory::</span>

<span class="sd">    python -m vcsa_monitor --vcsa vcenter.local.intranet --username &quot;monitor@vsphere.local&quot;</span>
<span class="sd">    --password &quot;xxxxxxxxxx&quot; --method &quot;health_memory&quot;</span>

<span class="sd">- Get health storage::</span>

<span class="sd">    python -m vcsa_monitor --vcsa vcenter.local.intranet --username &quot;monitor@vsphere.local&quot;</span>
<span class="sd">    --password &quot;xxxxxxxxxx&quot; --method &quot;health_storage&quot;</span>

<span class="sd">- Get health swap::</span>

<span class="sd">    python -m vcsa_monitor --vcsa vcenter.local.intranet --username &quot;monitor@vsphere.local&quot;</span>
<span class="sd">    --password &quot;xxxxxxxxxx&quot; --method &quot;health_swap&quot;</span>

<span class="sd">- Get health system::</span>

<span class="sd">    python -m vcsa_monitor --vcsa vcenter.local.intranet --username &quot;monitor@vsphere.local&quot;</span>
<span class="sd">    --password &quot;xxxxxxxxxx&quot; --method &quot;health_system&quot;</span>

<span class="sd">- Get CPU usage::</span>

<span class="sd">    python -m vcsa_monitor --vcsa vcenter.local.intranet --username &quot;monitor@vsphere.local&quot;</span>
<span class="sd">    --password &quot;xxxxxxxxxx&quot; --method &quot;cpu_util&quot; --function &quot;AVG&quot;</span>

<span class="sd">- Get memory usage::</span>

<span class="sd">    python -m vcsa_monitor --vcsa vcenter.local.intranet --username &quot;monitor@vsphere.local&quot;</span>
<span class="sd">    --password &quot;xxxxxxxxxx&quot; --method &quot;mem_usage&quot; --function &quot;AVG&quot;</span>

<span class="sd">- Get system load per min::</span>

<span class="sd">    python -m vcsa_monitor --vcsa vcenter.local.intranet --username &quot;monitor@vsphere.local&quot;</span>
<span class="sd">    --password &quot;xxxxxxxxxx&quot; --method &quot;systemload&quot; --function &quot;AVG&quot;</span>

<span class="sd">- Get disk latency rate (dm-[0:10])::</span>

<span class="sd">    python -m vcsa_monitor --vcsa vcenter.local.intranet --username &quot;monitor@vsphere.local&quot;</span>
<span class="sd">    --password &quot;xxxxxxxxxx&quot; --method &quot;disk_latencyrate&quot; --function &quot;MAX&quot;</span>

<span class="sd">- Get disk read rate (dm-[0:10])::</span>

<span class="sd">    python -m vcsa_monitor --vcsa vcenter.local.intranet --username &quot;monitor@vsphere.local&quot;</span>
<span class="sd">    --password &quot;xxxxxxxxxx&quot; --method &quot;disk_readrate&quot; --function &quot;MAX&quot;</span>

<span class="sd">- Get disk write rate (dm-[0:10])::</span>

<span class="sd">    python -m vcsa_monitor --vcsa vcenter.local.intranet --username &quot;monitor@vsphere.local&quot;</span>
<span class="sd">    --password &quot;xxxxxxxxxx&quot; --method &quot;disk_writerate&quot; --function &quot;MAX&quot;</span>

<span class="sd">- Get ethernet interface eth0 bits received rate::</span>

<span class="sd">    python -m vcsa_monitor --vcsa vcenter.local.intranet --username &quot;monitor@vsphere.local&quot;</span>
<span class="sd">    --password &quot;xxxxxxxxxx&quot; --method &quot;rx_activity_eth0&quot; --function &quot;MAX&quot;</span>

<span class="sd">- Get ethernet interface eth0 bits transmitted rate::</span>

<span class="sd">    python -m vcsa_monitor --vcsa vcenter.local.intranet --username &quot;monitor@vsphere.local&quot;</span>
<span class="sd">    --password &quot;xxxxxxxxxx&quot; --method &quot;tx_activity_eth0&quot; --function &quot;MAX&quot;</span>

<span class="sd">- Get ethernet interface eth0 packets received rate::</span>

<span class="sd">    python -m vcsa_monitor --vcsa vcenter.local.intranet --username &quot;monitor@vsphere.local&quot;</span>
<span class="sd">    --password &quot;xxxxxxxxxx&quot; --method &quot;rx_packetRate_eth0&quot; --function &quot;MAX&quot;</span>

<span class="sd">- Get ethernet interface eth0 packets transmitted rate::</span>

<span class="sd">    python -m vcsa_monitor --vcsa vcenter.local.intranet --username &quot;monitor@vsphere.local&quot;</span>
<span class="sd">    --password &quot;xxxxxxxxxx&quot; --method &quot;tx_packetRate_eth0&quot; --function &quot;MAX&quot;</span>

<span class="sd">- Get ethernet interface eth0 drops received rate::</span>

<span class="sd">    python -m vcsa_monitor --vcsa vcenter.local.intranet --username &quot;monitor@vsphere.local&quot;</span>
<span class="sd">    --password &quot;xxxxxxxxxx&quot; --method &quot;rx_drop_eth0&quot; --function &quot;MAX&quot;</span>

<span class="sd">- Get ethernet interface eth0 drops transmitted rate::</span>

<span class="sd">    python -m vcsa_monitor --vcsa vcenter.local.intranet --username &quot;monitor@vsphere.local&quot;</span>
<span class="sd">    --password &quot;xxxxxxxxxx&quot; --method &quot;tx_drop_eth0&quot; --function &quot;MAX&quot;</span>

<span class="sd">- Get ethernet interface eth0 errors received rate::</span>

<span class="sd">    python -m vcsa_monitor --vcsa vcenter.local.intranet --username &quot;monitor@vsphere.local&quot;</span>
<span class="sd">    --password &quot;xxxxxxxxxx&quot; --method &quot;rx_error_eth0&quot; --function &quot;MAX&quot;</span>

<span class="sd">- Get ethernet interface eth0 errors transmitted rate::</span>

<span class="sd">    python -m vcsa_monitor --vcsa vcenter.local.intranet --username &quot;monitor@vsphere.local&quot;</span>
<span class="sd">    --password &quot;xxxxxxxxxx&quot; --method &quot;tx_error_eth0&quot; --function &quot;MAX&quot;</span>

<span class="sd">- Get ethernet interface eth1 bits received rate::</span>

<span class="sd">    python -m vcsa_monitor --vcsa vcenter.local.intranet --username &quot;monitor@vsphere.local&quot;</span>
<span class="sd">    --password &quot;xxxxxxxxxx&quot; --method &quot;rx_activity_eth1&quot; --function &quot;MAX&quot;</span>

<span class="sd">- Get ethernet interface eth1 bits transmitted rate::</span>

<span class="sd">    python -m vcsa_monitor --vcsa vcenter.local.intranet --username &quot;monitor@vsphere.local&quot;</span>
<span class="sd">    --password &quot;xxxxxxxxxx&quot; --method &quot;tx_activity_eth1&quot; --function &quot;MAX&quot;</span>

<span class="sd">- Get ethernet interface eth1 packets received rate::</span>

<span class="sd">    python -m vcsa_monitor --vcsa vcenter.local.intranet --username &quot;monitor@vsphere.local&quot;</span>
<span class="sd">    --password &quot;xxxxxxxxxx&quot; --method &quot;rx_packetRate_eth1&quot; --function &quot;MAX&quot;</span>

<span class="sd">- Get ethernet interface eth1 packets transmitted rate::</span>

<span class="sd">    python -m vcsa_monitor --vcsa vcenter.local.intranet --username &quot;monitor@vsphere.local&quot;</span>
<span class="sd">    --password &quot;xxxxxxxxxx&quot; --method &quot;tx_packetRate_eth1&quot; --function &quot;MAX&quot;</span>

<span class="sd">- Get ethernet interface eth1 drops received rate::</span>

<span class="sd">    python -m vcsa_monitor --vcsa vcenter.local.intranet --username &quot;monitor@vsphere.local&quot;</span>
<span class="sd">    --password &quot;xxxxxxxxxx&quot; --method &quot;rx_drop_eth1&quot; --function &quot;MAX&quot;</span>

<span class="sd">- Get ethernet interface eth1 drops transmitted rate::</span>

<span class="sd">    python -m vcsa_monitor --vcsa vcenter.local.intranet --username &quot;monitor@vsphere.local&quot;</span>
<span class="sd">    --password &quot;xxxxxxxxxx&quot; --method &quot;tx_drop_eth1&quot; --function &quot;MAX&quot;</span>

<span class="sd">- Get ethernet interface eth1 errors received rate::</span>

<span class="sd">    python -m vcsa_monitor --vcsa vcenter.local.intranet --username &quot;monitor@vsphere.local&quot;</span>
<span class="sd">    --password &quot;xxxxxxxxxx&quot; --method &quot;rx_error_eth1&quot; --function &quot;MAX&quot;</span>

<span class="sd">- Get ethernet interface eth1 errors transmitted rate::</span>

<span class="sd">    python -m vcsa_monitor --vcsa vcenter.local.intranet --username &quot;monitor@vsphere.local&quot;</span>
<span class="sd">    --password &quot;xxxxxxxxxx&quot; --method &quot;tx_error_eth1&quot; --function &quot;MAX&quot;</span>

<span class="sd">- Get filesystem root usage::</span>

<span class="sd">    python -m vcsa_monitor --vcsa vcenter.local.intranet --username &quot;monitor@vsphere.local&quot;</span>
<span class="sd">    --password &quot;xxxxxxxxxx&quot; --method &quot;fs_root&quot; --function &quot;MAX&quot;</span>

<span class="sd">- Get filesystem boot usage::</span>

<span class="sd">    python -m vcsa_monitor --vcsa vcenter.local.intranet --username &quot;monitor@vsphere.local&quot;</span>
<span class="sd">    --password &quot;xxxxxxxxxx&quot; --method &quot;fs_boot&quot; --function &quot;MAX&quot;</span>

<span class="sd">- Get filesystem swap usage::</span>

<span class="sd">    python -m vcsa_monitor --vcsa vcenter.local.intranet --username &quot;monitor@vsphere.local&quot;</span>
<span class="sd">    --password &quot;xxxxxxxxxx&quot; --method &quot;fs_swap&quot; --function &quot;MAX&quot;</span>

<span class="sd">- Get filesystem log usage::</span>

<span class="sd">    python -m vcsa_monitor --vcsa vcenter.local.intranet --username &quot;monitor@vsphere.local&quot;</span>
<span class="sd">    --password &quot;xxxxxxxxxx&quot; --method &quot;fs_log&quot; --function &quot;MAX&quot;</span>

<span class="sd">- Get filesystem db usage::</span>

<span class="sd">    python -m vcsa_monitor --vcsa vcenter.local.intranet --username &quot;monitor@vsphere.local&quot;</span>
<span class="sd">    --password &quot;xxxxxxxxxx&quot; --method &quot;fs_db&quot; --function &quot;MAX&quot;</span>

<span class="sd">- Get filesystem dblog usage::</span>

<span class="sd">    python -m vcsa_monitor --vcsa vcenter.local.intranet --username &quot;monitor@vsphere.local&quot;</span>
<span class="sd">    --password &quot;xxxxxxxxxx&quot; --method &quot;fs_dblog&quot; --function &quot;MAX&quot;</span>

<span class="sd">- Get filesystem seat usage::</span>

<span class="sd">    python -m vcsa_monitor --vcsa vcenter.local.intranet --username &quot;monitor@vsphere.local&quot;</span>
<span class="sd">    --password &quot;xxxxxxxxxx&quot; --method &quot;fs_seat&quot; --function &quot;MAX&quot;</span>

<span class="sd">- Get filesystem core usage::</span>

<span class="sd">    python -m vcsa_monitor --vcsa vcenter.local.intranet --username &quot;monitor@vsphere.local&quot;</span>
<span class="sd">    --password &quot;xxxxxxxxxx&quot; --method &quot;fs_core&quot; --function &quot;MAX&quot;</span>

<span class="sd">- Get filesystem archive usage::</span>

<span class="sd">    python -m vcsa_monitor --vcsa vcenter.local.intranet --username &quot;monitor@vsphere.local&quot;</span>
<span class="sd">    --password &quot;xxxxxxxxxx&quot; --method &quot;fs_archive&quot; --function &quot;MAX&quot;</span>

<span class="sd">- Get filesystem updatemgr usage::</span>

<span class="sd">    python -m vcsa_monitor --vcsa vcenter.local.intranet --username &quot;monitor@vsphere.local&quot;</span>
<span class="sd">    --password &quot;xxxxxxxxxx&quot; --method &quot;fs_updatemgr&quot; --function &quot;MAX&quot;</span>

<span class="sd">- Get filesystem imagebuilder usage::</span>

<span class="sd">    python -m vcsa_monitor --vcsa vcenter.local.intranet --username &quot;monitor@vsphere.local&quot;</span>
<span class="sd">    --password &quot;xxxxxxxxxx&quot; --method &quot;fs_imagebuilder&quot; --function &quot;MAX&quot;</span>

<span class="sd">- Get filesystem autodeploy usage::</span>

<span class="sd">    python -m vcsa_monitor --vcsa vcenter.local.intranet --username &quot;monitor@vsphere.local&quot;</span>
<span class="sd">    --password &quot;xxxxxxxxxx&quot; --method &quot;fs_autodeploy&quot; --function &quot;MAX&quot;</span>

<span class="sd">- Get filesystem netdump usage::</span>

<span class="sd">    python -m vcsa_monitor --vcsa vcenter.local.intranet --username &quot;monitor@vsphere.local&quot;</span>
<span class="sd">    --password &quot;xxxxxxxxxx&quot; --method &quot;fs_netdump&quot; --function &quot;MAX&quot;</span>

<span class="sd">- Get content library synchronization status::</span>

<span class="sd">    python -m vcsa_monitor --vcsa vcenter.local.intranet --username &quot;monitor@vsphere.local&quot;</span>
<span class="sd">    --password &quot;xxxxxxxxxx&quot; --method &quot;content_library&quot;</span>

<span class="sd">- Get latest backup status::</span>

<span class="sd">    python -m vcsa_monitor --vcsa vcenter.local.intranet --username &quot;monitor@vsphere.local&quot;</span>
<span class="sd">    --password &quot;xxxxxxxxxx&quot; --method &quot;backup_status&quot;</span>

<span class="sd">- Get health status of all services::</span>

<span class="sd">    python -m vcsa_monitor --vcsa vcenter.local.intranet --username &quot;monitor@vsphere.local&quot;</span>
<span class="sd">    --password &quot;xxxxxxxxxx&quot; --method &quot;srvc_all&quot;</span>

<span class="sd">- Get health status of content library service::</span>

<span class="sd">    python -m vcsa_monitor --vcsa vcenter.local.intranet --username &quot;monitor@vsphere.local&quot;</span>
<span class="sd">    --password &quot;xxxxxxxxxx&quot; --method &quot;srvc_content-library&quot;</span>

<span class="sd">- Get health status of psc service::</span>

<span class="sd">    python -m vcsa_monitor --vcsa vcenter.local.intranet --username &quot;monitor@vsphere.local&quot;</span>
<span class="sd">    --password &quot;xxxxxxxxxx&quot; --method &quot;srvc_pschealth&quot;</span>

<span class="sd">- Get health status of vcsa service::</span>

<span class="sd">    python -m vcsa_monitor --vcsa vcenter.local.intranet --username &quot;monitor@vsphere.local&quot;</span>
<span class="sd">    --password &quot;xxxxxxxxxx&quot; --method &quot;srvc_vcha&quot;</span>

<span class="sd">- Get health status of vpostgres service::</span>

<span class="sd">    python -m vcsa_monitor --vcsa vcenter.local.intranet --username &quot;monitor@vsphere.local&quot;</span>
<span class="sd">    --password &quot;xxxxxxxxxx&quot; --method &quot;srvc_vmware-vpostgres&quot;</span>

<span class="sd">- Get health status of vpostgres-archiver service::</span>

<span class="sd">    python -m vcsa_monitor --vcsa vcenter.local.intranet --username &quot;monitor@vsphere.local&quot;</span>
<span class="sd">    --password &quot;xxxxxxxxxx&quot; --method &quot;srvc_vmware-postgres-archiver&quot;</span>

<span class="sd">- Get health status of vpxd service::</span>

<span class="sd">    python -m vcsa_monitor --vcsa vcenter.local.intranet --username &quot;monitor@vsphere.local&quot;</span>
<span class="sd">    --password &quot;xxxxxxxxxx&quot; --method &quot;srvc_vpxd&quot;</span>

<span class="sd">- Get health status of vsan service::</span>

<span class="sd">    python -m vcsa_monitor --vcsa vcenter.local.intranet --username &quot;monitor@vsphere.local&quot;</span>
<span class="sd">    --password &quot;xxxxxxxxxx&quot; --method &quot;srvc_vsan-health&quot;</span>

<span class="sd">- Get health status of vsphere-client service::</span>

<span class="sd">    python -m vcsa_monitor --vcsa vcenter.local.intranet --username &quot;monitor@vsphere.local&quot;</span>
<span class="sd">    --password &quot;xxxxxxxxxx&quot; --method &quot;srvc_vsphere-ui&quot;</span>

<span class="sd">- Get updates available::</span>

<span class="sd">    python -m vcsa_monitor --vcsa vcenter.local.intranet --username &quot;monitor@vsphere.local&quot;</span>
<span class="sd">    --password &quot;xxxxxxxxxx&quot; --method &quot;available_updates&quot;</span>

<span class="sd">- Get vcha node active::</span>

<span class="sd">    python -m vcsa_monitor --vcsa vcenter.local.intranet --username &quot;monitor@vsphere.local&quot;</span>
<span class="sd">    --password &quot;xxxxxxxxxx&quot; --method &quot;vcha_active_node&quot;</span>

<span class="sd">- Get vcha health cluster::</span>

<span class="sd">    python -m vcsa_monitor --vcsa vcenter.local.intranet --username &quot;monitor@vsphere.local&quot;</span>
<span class="sd">    --password &quot;xxxxxxxxxx&quot; --method &quot;vcha_health_cluster&quot;</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">core</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">config</span>
<span class="kn">from</span> <span class="nn">.authentication</span> <span class="k">import</span> <span class="n">authentication</span>
<span class="kn">from</span> <span class="nn">.backup</span> <span class="k">import</span> <span class="n">backup</span>
<span class="kn">from</span> <span class="nn">.content_library</span> <span class="k">import</span> <span class="n">content_library</span>
<span class="kn">from</span> <span class="nn">.cpu_mem</span> <span class="k">import</span> <span class="n">cpu_mem</span>
<span class="kn">from</span> <span class="nn">.database</span> <span class="k">import</span> <span class="n">database</span>
<span class="kn">from</span> <span class="nn">.disk</span> <span class="k">import</span> <span class="n">disk</span>
<span class="kn">from</span> <span class="nn">.health</span> <span class="k">import</span> <span class="n">health</span>
<span class="kn">from</span> <span class="nn">.network</span> <span class="k">import</span> <span class="n">network</span>
<span class="kn">from</span> <span class="nn">.storage</span> <span class="k">import</span> <span class="n">storage</span>
<span class="kn">from</span> <span class="nn">.system</span> <span class="k">import</span> <span class="n">uptime</span>
<span class="kn">from</span> <span class="nn">.system</span> <span class="k">import</span> <span class="n">version</span>
<span class="kn">from</span> <span class="nn">.updates</span> <span class="k">import</span> <span class="n">updates</span>
<span class="kn">from</span> <span class="nn">.vcha</span> <span class="k">import</span> <span class="n">vcha</span>
<span class="kn">from</span> <span class="nn">.vmon</span> <span class="k">import</span> <span class="n">vmon</span>


<span class="c1"># noinspection PyTypeChecker</span>
<div class="viewcode-block" id="save_restapi_health"><a class="viewcode-back" href="../../index.html#vcsa_monitor.__main__.save_restapi_health">[docs]</a><span class="k">def</span> <span class="nf">save_restapi_health</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">save</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Store rest api status</span>

<span class="sd">    :param vcsa: name of a specific vCenter (fqdn)</span>
<span class="sd">    :type vcsa: str</span>
<span class="sd">    :param status: status of the rest api</span>
<span class="sd">    :type status: int</span>
<span class="sd">    :param save: store data to database InfluxDB or Graphite</span>
<span class="sd">    :type save: str</span>
<span class="sd">    :param log: enable log to file</span>
<span class="sd">    :type log: bool</span>
<span class="sd">    :param debug: enable debug</span>
<span class="sd">    :type debug: bool</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tsepoch</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
    <span class="n">tsdt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcfromtimestamp</span><span class="p">(</span><span class="n">tsepoch</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">T%H:%M:%S.000Z&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">save</span> <span class="o">==</span> <span class="s2">&quot;influxdb&quot;</span><span class="p">:</span>
        <span class="c1"># Store data to database InfluxDB</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="n">status</span>
        <span class="p">}</span>
        <span class="n">database</span><span class="o">.</span><span class="n">store2influx</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="s2">&quot;restapi_health&quot;</span><span class="p">,</span> <span class="n">tsdt</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">save</span> <span class="o">==</span> <span class="s2">&quot;graphite&quot;</span><span class="p">:</span>
        <span class="c1"># Store data to database Graphite</span>
        <span class="n">database</span><span class="o">.</span><span class="n">store2graphite</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="s2">&quot;restapi_health&quot;</span><span class="p">,</span> <span class="n">tsepoch</span><span class="p">,</span> <span class="s2">&quot;status&quot;</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span></div>


<div class="viewcode-block" id="rest_version"><a class="viewcode-back" href="../../index.html#vcsa_monitor.__main__.rest_version">[docs]</a><span class="k">def</span> <span class="nf">rest_version</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="n">save</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Use rest method version and store result</span>

<span class="sd">    :param vcsa: name of a specific vCenter (fqdn)</span>
<span class="sd">    :type vcsa: str</span>
<span class="sd">    :param token: session id</span>
<span class="sd">    :type token: str</span>
<span class="sd">    :param save: store data to database InfluxDB or Graphite</span>
<span class="sd">    :type save: str</span>
<span class="sd">    :param log: enable log to file</span>
<span class="sd">    :type log: bool</span>
<span class="sd">    :param debug: enable debug</span>
<span class="sd">    :type debug: bool</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">version</span><span class="o">.</span><span class="n">get_version</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>
    <span class="n">tsepoch</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">product</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">release_date</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">release</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">build</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
    <span class="nb">type</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">save</span> <span class="o">==</span> <span class="s2">&quot;influxdb&quot;</span><span class="p">:</span>
        <span class="c1"># Store data to database InfluxDB</span>
        <span class="n">tsdt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcfromtimestamp</span><span class="p">(</span><span class="n">tsepoch</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">T%H:%M:%S.000Z&quot;</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;product&quot;</span><span class="p">:</span> <span class="n">product</span><span class="p">,</span>
            <span class="s2">&quot;release_date&quot;</span><span class="p">:</span> <span class="n">release_date</span><span class="p">,</span>
            <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="n">release</span><span class="p">,</span>
            <span class="s2">&quot;build&quot;</span><span class="p">:</span> <span class="n">build</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="nb">type</span>
        <span class="p">}</span>
        <span class="n">database</span><span class="o">.</span><span class="n">store2influx</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="s2">&quot;version&quot;</span><span class="p">,</span> <span class="n">tsdt</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">save</span> <span class="o">==</span> <span class="s2">&quot;graphite&quot;</span><span class="p">:</span>
        <span class="c1"># Store data to database Graphite</span>
        <span class="c1">#database.store2graphite(vcsa, &quot;version&quot;, tsepoch, &quot;product&quot;, str(product), log, debug)</span>
        <span class="c1">#database.store2graphite(vcsa, &quot;version&quot;, tsepoch, &quot;release_date&quot;, str(release_date), log, debug)</span>
        <span class="c1">#database.store2graphite(vcsa, &quot;version&quot;, tsepoch, &quot;version&quot;, str(release), log, debug)</span>
        <span class="c1">#database.store2graphite(vcsa, &quot;version&quot;, tsepoch, &quot;build&quot;, str(build), log, debug)</span>
        <span class="c1">#database.store2graphite(vcsa, &quot;version&quot;, tsepoch, &quot;type&quot;, str(type), log, debug)</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[DEBUG] Graphite time series database does not support this type of metric!&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">log</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Graphite time series database does not support this type of metric!&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="rest_uptime"><a class="viewcode-back" href="../../index.html#vcsa_monitor.__main__.rest_uptime">[docs]</a><span class="k">def</span> <span class="nf">rest_uptime</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="n">save</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Use rest method uptime and store result</span>

<span class="sd">    :param vcsa: name of a specific vCenter (fqdn)</span>
<span class="sd">    :type vcsa: str</span>
<span class="sd">    :param token: session id</span>
<span class="sd">    :type token: str</span>
<span class="sd">    :param save: store data to database InfluxDB or Graphite</span>
<span class="sd">    :type save: str</span>
<span class="sd">    :param log: enable log to file</span>
<span class="sd">    :type log: bool</span>
<span class="sd">    :param debug: enable debug</span>
<span class="sd">    :type debug: bool</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">uptime</span><span class="o">.</span><span class="n">get_uptime</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>
    <span class="n">tsepoch</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">save</span> <span class="o">==</span> <span class="s2">&quot;influxdb&quot;</span><span class="p">:</span>
        <span class="c1"># Store data to database InfluxDB</span>
        <span class="n">tsdt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcfromtimestamp</span><span class="p">(</span><span class="n">tsepoch</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">T%H:%M:%S.000Z&quot;</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;days&quot;</span><span class="p">:</span> <span class="n">value</span>
        <span class="p">}</span>
        <span class="n">database</span><span class="o">.</span><span class="n">store2influx</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="s2">&quot;uptime&quot;</span><span class="p">,</span> <span class="n">tsdt</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">save</span> <span class="o">==</span> <span class="s2">&quot;graphite&quot;</span><span class="p">:</span>
        <span class="c1"># Store data to database Graphite</span>
        <span class="n">database</span><span class="o">.</span><span class="n">store2graphite</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="s2">&quot;uptime&quot;</span><span class="p">,</span> <span class="n">tsepoch</span><span class="p">,</span> <span class="s2">&quot;days&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span></div>


<div class="viewcode-block" id="rest_health"><a class="viewcode-back" href="../../index.html#vcsa_monitor.__main__.rest_health">[docs]</a><span class="k">def</span> <span class="nf">rest_health</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">save</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Use rest method health and store result</span>

<span class="sd">    :param vcsa: name of a specific vCenter (fqdn)</span>
<span class="sd">    :type vcsa: str</span>
<span class="sd">    :param token: session id</span>
<span class="sd">    :type token: str</span>
<span class="sd">    :param method: set a specific method (value = load, mem, storage, swap, system, software-packages, database-storage)</span>
<span class="sd">    :type method: str</span>
<span class="sd">    :param save: store data to database InfluxDB or Graphite</span>
<span class="sd">    :type save: str</span>
<span class="sd">    :param log: enable log to file</span>
<span class="sd">    :type log: bool</span>
<span class="sd">    :param debug: enable debug</span>
<span class="sd">    :type debug: bool</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;health_load&quot;</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">health</span><span class="o">.</span><span class="n">get_health</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="s2">&quot;load&quot;</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;health_memory&quot;</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">health</span><span class="o">.</span><span class="n">get_health</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="s2">&quot;mem&quot;</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;health_storage&quot;</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">health</span><span class="o">.</span><span class="n">get_health</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="s2">&quot;storage&quot;</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;health_swap&quot;</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">health</span><span class="o">.</span><span class="n">get_health</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="s2">&quot;swap&quot;</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;health_system&quot;</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">health</span><span class="o">.</span><span class="n">get_health</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="s2">&quot;system&quot;</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;health_softwarepackages&quot;</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">health</span><span class="o">.</span><span class="n">get_health</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="s2">&quot;software-packages&quot;</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;health_databasestorage&quot;</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">health</span><span class="o">.</span><span class="n">get_health</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="s2">&quot;database-storage&quot;</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;health_applmgmt&quot;</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">health</span><span class="o">.</span><span class="n">get_health</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="s2">&quot;applmgmt&quot;</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>

    <span class="n">tsepoch</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">save</span> <span class="o">==</span> <span class="s2">&quot;influxdb&quot;</span><span class="p">:</span>
        <span class="c1"># Store data to database InfluxDB</span>
        <span class="n">tsdt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcfromtimestamp</span><span class="p">(</span><span class="n">tsepoch</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">T%H:%M:%S.000Z&quot;</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="n">value</span>
        <span class="p">}</span>
        <span class="n">database</span><span class="o">.</span><span class="n">store2influx</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">tsdt</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">save</span> <span class="o">==</span> <span class="s2">&quot;graphite&quot;</span><span class="p">:</span>
        <span class="c1"># Store data to database Graphite</span>
        <span class="n">database</span><span class="o">.</span><span class="n">store2graphite</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">tsepoch</span><span class="p">,</span> <span class="s2">&quot;status&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span></div>


<div class="viewcode-block" id="rest_cpu_mem_usage"><a class="viewcode-back" href="../../index.html#vcsa_monitor.__main__.rest_cpu_mem_usage">[docs]</a><span class="k">def</span> <span class="nf">rest_cpu_mem_usage</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="n">save</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Use rest method cpu/memory utilization and store result</span>

<span class="sd">    :param vcsa: name of a specific vCenter (fqdn)</span>
<span class="sd">    :type vcsa: str</span>
<span class="sd">    :param token: session id</span>
<span class="sd">    :type token: str</span>
<span class="sd">    :param method: set a specific method (value = cpu, memory)</span>
<span class="sd">    :type method: str</span>
<span class="sd">    :param function: set a specific metric function (value = MIN, AVG, MAX)</span>
<span class="sd">    :type function: str</span>
<span class="sd">    :param save: store data to database InfluxDB or Graphite</span>
<span class="sd">    :type save: str</span>
<span class="sd">    :param log: enable log to file</span>
<span class="sd">    :type log: bool</span>
<span class="sd">    :param debug: enable debug</span>
<span class="sd">    :type debug: bool</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;cpu_util&quot;</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">cpu_mem</span><span class="o">.</span><span class="n">get_cpu_mem_usage</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="s2">&quot;cpu&quot;</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;mem_usage&quot;</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">cpu_mem</span><span class="o">.</span><span class="n">get_cpu_mem_usage</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="s2">&quot;memory&quot;</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>

    <span class="n">tsepoch</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">save</span> <span class="o">==</span> <span class="s2">&quot;influxdb&quot;</span><span class="p">:</span>
        <span class="c1"># Store data to database InfluxDB</span>
        <span class="n">tsdt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcfromtimestamp</span><span class="p">(</span><span class="n">tsepoch</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">T%H:%M:%S.000Z&quot;</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;percent&quot;</span><span class="p">:</span> <span class="n">value</span>
        <span class="p">}</span>
        <span class="n">database</span><span class="o">.</span><span class="n">store2influx</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">tsdt</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">save</span> <span class="o">==</span> <span class="s2">&quot;graphite&quot;</span><span class="p">:</span>
        <span class="c1"># Store data to database Graphite</span>
        <span class="n">database</span><span class="o">.</span><span class="n">store2graphite</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">tsepoch</span><span class="p">,</span> <span class="s2">&quot;percent&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span></div>


<div class="viewcode-block" id="rest_systemload"><a class="viewcode-back" href="../../index.html#vcsa_monitor.__main__.rest_systemload">[docs]</a><span class="k">def</span> <span class="nf">rest_systemload</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="n">save</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Use rest method systemload and store result</span>

<span class="sd">    :param vcsa: name of a specific vCenter (fqdn)</span>
<span class="sd">    :type vcsa: str</span>
<span class="sd">    :param token: session id</span>
<span class="sd">    :type token: str</span>
<span class="sd">    :param function: set a specific metric function (value = MIN, AVG, MAX)</span>
<span class="sd">    :type function: str</span>
<span class="sd">    :param save: store data to database InfluxDB or Graphite</span>
<span class="sd">    :type save: str</span>
<span class="sd">    :param log: enable log to file</span>
<span class="sd">    :type log: bool</span>
<span class="sd">    :param debug: enable debug</span>
<span class="sd">    :type debug: bool</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">cpu_mem</span><span class="o">.</span><span class="n">get_systemload</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>
    <span class="n">tsepoch</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">save</span> <span class="o">==</span> <span class="s2">&quot;influxdb&quot;</span><span class="p">:</span>
        <span class="c1"># Store data to database InfluxDB</span>
        <span class="n">tsdt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcfromtimestamp</span><span class="p">(</span><span class="n">tsepoch</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">T%H:%M:%S.000Z&quot;</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;load&quot;</span><span class="p">:</span> <span class="n">value</span>
        <span class="p">}</span>
        <span class="n">database</span><span class="o">.</span><span class="n">store2influx</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="s2">&quot;load_per_min&quot;</span><span class="p">,</span> <span class="n">tsdt</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">save</span> <span class="o">==</span> <span class="s2">&quot;graphite&quot;</span><span class="p">:</span>
        <span class="c1"># Store data to database Graphite</span>
        <span class="n">database</span><span class="o">.</span><span class="n">store2graphite</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="s2">&quot;system_load&quot;</span><span class="p">,</span> <span class="n">tsepoch</span><span class="p">,</span> <span class="s2">&quot;load_per_min&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span></div>


<div class="viewcode-block" id="rest_disk_performance"><a class="viewcode-back" href="../../index.html#vcsa_monitor.__main__.rest_disk_performance">[docs]</a><span class="k">def</span> <span class="nf">rest_disk_performance</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="n">save</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Use rest method disk performance and store result</span>

<span class="sd">    :param vcsa: name of a specific vCenter (fqdn)</span>
<span class="sd">    :type vcsa: str</span>
<span class="sd">    :param token: session id</span>
<span class="sd">    :type token: str</span>
<span class="sd">    :param method: set a specific method (value = disk_latencyrate, disk_readrate, disk_writerate)</span>
<span class="sd">    :type method: str</span>
<span class="sd">    :param function: set a specific metric function (value = MIN, AVG, MAX)</span>
<span class="sd">    :type function: str</span>
<span class="sd">    :param save: store data to database InfluxDB or Graphite</span>
<span class="sd">    :type save: str</span>
<span class="sd">    :param log: enable log to file</span>
<span class="sd">    :type log: bool</span>
<span class="sd">    :param debug: enable debug</span>
<span class="sd">    :type debug: bool</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">disk</span><span class="o">.</span><span class="n">get_disk_performance</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>
    <span class="n">tsepoch</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">rate</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">save</span> <span class="o">==</span> <span class="s2">&quot;influxdb&quot;</span><span class="p">:</span>
        <span class="c1"># Store data to database InfluxDB</span>
        <span class="n">tsdt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcfromtimestamp</span><span class="p">(</span><span class="n">tsepoch</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">T%H:%M:%S.000Z&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">rate</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;rate&quot;</span><span class="p">:</span> <span class="n">value</span>
            <span class="p">}</span>
            <span class="n">database</span><span class="o">.</span><span class="n">store2influx</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">tsdt</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">save</span> <span class="o">==</span> <span class="s2">&quot;graphite&quot;</span><span class="p">:</span>
        <span class="c1"># Store data to database Graphite</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">rate</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">database</span><span class="o">.</span><span class="n">store2graphite</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">tsepoch</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span></div>


<div class="viewcode-block" id="rest_network_performance"><a class="viewcode-back" href="../../index.html#vcsa_monitor.__main__.rest_network_performance">[docs]</a><span class="k">def</span> <span class="nf">rest_network_performance</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="n">save</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Use rest method network performance and store result</span>

<span class="sd">    :param vcsa: name of a specific vCenter (fqdn)</span>
<span class="sd">    :type vcsa: str</span>
<span class="sd">    :param token: session id</span>
<span class="sd">    :type token: str</span>
<span class="sd">    :param method: set a specific method (value = rx_activity_eth0, rx_activity_eth1, rx_packetRate_eth0,</span>
<span class="sd">                                                  rx_packetRate_eth1, rx_drop_eth0, rx_drop_eth1, rx_error_eth0,</span>
<span class="sd">                                                  rx_error_eth1, tx_activity_eth0, tx_activity_eth1, tx_packetRate_eth0,</span>
<span class="sd">                                                  tx_packetRate_eth1, tx_drop_eth0, tx_drop_eth1, tx_error_eth0,</span>
<span class="sd">                                                  tx_error_eth1)</span>
<span class="sd">    :type method: str</span>
<span class="sd">    :param function: set a specific metric function (value = MIN, AVG, MAX)</span>
<span class="sd">    :type function: str</span>
<span class="sd">    :param save: store data to database InfluxDB or Graphite</span>
<span class="sd">    :type save: str</span>
<span class="sd">    :param log: enable log to file</span>
<span class="sd">    :type log: bool</span>
<span class="sd">    :param debug: enable debug</span>
<span class="sd">    :type debug: bool</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">network</span><span class="o">.</span><span class="n">get_network_performance</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>
    <span class="n">tsepoch</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">unit</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">save</span> <span class="o">==</span> <span class="s2">&quot;influxdb&quot;</span><span class="p">:</span>
        <span class="c1"># Store data to database InfluxDB</span>
        <span class="n">tsdt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcfromtimestamp</span><span class="p">(</span><span class="n">tsepoch</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">T%H:%M:%S.000Z&quot;</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">unit</span><span class="p">:</span> <span class="n">value</span>
        <span class="p">}</span>
        <span class="n">database</span><span class="o">.</span><span class="n">store2influx</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">tsdt</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">save</span> <span class="o">==</span> <span class="s2">&quot;graphite&quot;</span><span class="p">:</span>
        <span class="c1"># Store data to database Graphite</span>
        <span class="n">database</span><span class="o">.</span><span class="n">store2graphite</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">tsepoch</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span></div>


<div class="viewcode-block" id="rest_filesystem_usage"><a class="viewcode-back" href="../../index.html#vcsa_monitor.__main__.rest_filesystem_usage">[docs]</a><span class="k">def</span> <span class="nf">rest_filesystem_usage</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="n">save</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Use rest method filesystem usage and store data</span>

<span class="sd">    :param vcsa: name of a specific vCenter (fqdn)</span>
<span class="sd">    :type vcsa: str</span>
<span class="sd">    :param token: session id</span>
<span class="sd">    :type token: str</span>
<span class="sd">    :param method: set a specific method (value = fs_root, fs_swap, fs_boot, fs_core, fs_log, fs_db, fs_dblog,</span>
<span class="sd">                                                fs_seat, fs_archive, fs_updatemgr, fs_imagebuilder, fs_autodeploy,</span>
<span class="sd">                                                fs_netdump, fs_lifecycle, fs_vtsdb, fs_vtsdblog)</span>
<span class="sd">    :type method: str</span>
<span class="sd">    :param function: set a specific metric function (value = MIN, AVG, MAX)</span>
<span class="sd">    :type function: str</span>
<span class="sd">    :param save: store data to database InfluxDB or Graphite</span>
<span class="sd">    :type save: str</span>
<span class="sd">    :param log: enable log to file</span>
<span class="sd">    :type log: bool</span>
<span class="sd">    :param debug: enable debug</span>
<span class="sd">    :type debug: bool</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">storage</span><span class="o">.</span><span class="n">get_filesystem_usage</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>
    <span class="n">tsepoch</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">save</span> <span class="o">==</span> <span class="s2">&quot;influxdb&quot;</span><span class="p">:</span>
        <span class="c1"># Store data to database InfluxDB</span>
        <span class="n">tsdt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcfromtimestamp</span><span class="p">(</span><span class="n">tsepoch</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">T%H:%M:%S.000Z&quot;</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;percent&quot;</span><span class="p">:</span> <span class="n">value</span>
        <span class="p">}</span>
        <span class="n">database</span><span class="o">.</span><span class="n">store2influx</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">tsdt</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">save</span> <span class="o">==</span> <span class="s2">&quot;graphite&quot;</span><span class="p">:</span>
        <span class="c1"># Store data to database Graphite</span>
        <span class="n">database</span><span class="o">.</span><span class="n">store2graphite</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">tsepoch</span><span class="p">,</span> <span class="s2">&quot;percent&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span></div>


<div class="viewcode-block" id="rest_content_library"><a class="viewcode-back" href="../../index.html#vcsa_monitor.__main__.rest_content_library">[docs]</a><span class="k">def</span> <span class="nf">rest_content_library</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="n">save</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Use rest method content library and store result</span>

<span class="sd">    :param vcsa: name of a specific vCenter (fqdn)</span>
<span class="sd">    :type vcsa: str</span>
<span class="sd">    :param token: session id</span>
<span class="sd">    :type token: str</span>
<span class="sd">    :param save: store data to database InfluxDB or Graphite</span>
<span class="sd">    :type save: str</span>
<span class="sd">    :param log: enable log to file</span>
<span class="sd">    :type log: bool</span>
<span class="sd">    :param debug: enable debug</span>
<span class="sd">    :type debug: bool</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">content_library</span><span class="o">.</span><span class="n">get_clib_sync</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>
    <span class="n">tsepoch</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">subscribed</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">not_sync</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">subscribed</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">not_sync</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[DEBUG] There are libraries unsynchronized&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">log</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;There are libraries unsynchronized&quot;</span><span class="p">)</span>

            <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;There are libraries unsynchronized&quot;</span>
            <span class="n">libraries</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">result</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
                <span class="n">libraries</span> <span class="o">+=</span> <span class="n">elem</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span>
            <span class="n">libraries</span> <span class="o">=</span> <span class="n">libraries</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">save</span> <span class="o">==</span> <span class="s2">&quot;influxdb&quot;</span><span class="p">:</span>
                <span class="c1"># Store data to database InfluxDB</span>
                <span class="n">tsdt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcfromtimestamp</span><span class="p">(</span><span class="n">tsepoch</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">T%H:%M:%S.000Z&quot;</span><span class="p">)</span>
                <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="n">message</span><span class="p">,</span>
                    <span class="s2">&quot;libraries&quot;</span><span class="p">:</span> <span class="n">libraries</span><span class="p">,</span>
                    <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="n">status</span>
                <span class="p">}</span>
                <span class="n">database</span><span class="o">.</span><span class="n">store2influx</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="s2">&quot;clib_sync&quot;</span><span class="p">,</span> <span class="n">tsdt</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">save</span> <span class="o">==</span> <span class="s2">&quot;graphite&quot;</span><span class="p">:</span>
                <span class="c1"># Store data to database Graphite</span>
                <span class="c1">#database.store2graphite(vcsa, &quot;clib_sync&quot;, tsepoch, &quot;message&quot;, message, log, debug)</span>
                <span class="c1">#database.store2graphite(vcsa, &quot;clib_sync&quot;, tsepoch, &quot;libraries&quot;, libraries, log, debug)</span>
                <span class="c1">#database.store2graphite(vcsa, &quot;clib_sync&quot;, tsepoch, &quot;status&quot;, status, log, debug)</span>
                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[DEBUG] Graphite time series database does not support this type of metric!&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">log</span><span class="p">:</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Graphite time series database does not support this type of metric!&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[DEBUG] All libraries are synchronized&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">log</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;All libraries are synchronized&quot;</span><span class="p">)</span>

            <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;All libraries are synchronized&quot;</span>
            <span class="n">libraries</span> <span class="o">=</span> <span class="s2">&quot;--&quot;</span>

            <span class="k">if</span> <span class="n">save</span> <span class="o">==</span> <span class="s2">&quot;influxdb&quot;</span><span class="p">:</span>
                <span class="c1"># Store data to database InfluxDB</span>
                <span class="n">tsdt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcfromtimestamp</span><span class="p">(</span><span class="n">tsepoch</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">T%H:%M:%S.000Z&quot;</span><span class="p">)</span>
                <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="n">message</span><span class="p">,</span>
                    <span class="s2">&quot;libraries&quot;</span><span class="p">:</span> <span class="n">libraries</span><span class="p">,</span>
                    <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="n">status</span>
                <span class="p">}</span>
                <span class="n">database</span><span class="o">.</span><span class="n">store2influx</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="s2">&quot;clib_sync&quot;</span><span class="p">,</span> <span class="n">tsdt</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">save</span> <span class="o">==</span> <span class="s2">&quot;graphite&quot;</span><span class="p">:</span>
                <span class="c1"># Store data to database Graphite</span>
                <span class="c1">#database.store2graphite(vcsa, &quot;clib_sync&quot;, tsepoch, &quot;message&quot;, message, log, debug)</span>
                <span class="c1">#database.store2graphite(vcsa, &quot;clib_sync&quot;, tsepoch, &quot;libraries&quot;, libraries, log, debug)</span>
                <span class="c1">#database.store2graphite(vcsa, &quot;clib_sync&quot;, tsepoch, &quot;status&quot;, status, log, debug)</span>
                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[DEBUG] Graphite time series database does not support this type of metric!&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">log</span><span class="p">:</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Graphite time series database does not support this type of metric!&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># There are no content library subscribed</span>
        <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;There are no content libraries subscribed&quot;</span>
        <span class="n">libraries</span> <span class="o">=</span> <span class="s2">&quot;--&quot;</span>

        <span class="k">if</span> <span class="n">save</span> <span class="o">==</span> <span class="s2">&quot;influxdb&quot;</span><span class="p">:</span>
            <span class="c1"># Store data to database InfluxDB</span>
            <span class="n">tsdt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcfromtimestamp</span><span class="p">(</span><span class="n">tsepoch</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">T%H:%M:%S.000Z&quot;</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="n">message</span><span class="p">,</span>
                <span class="s2">&quot;libraries&quot;</span><span class="p">:</span> <span class="n">libraries</span><span class="p">,</span>
                <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="n">status</span>
            <span class="p">}</span>
            <span class="n">database</span><span class="o">.</span><span class="n">store2influx</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="s2">&quot;clib_sync&quot;</span><span class="p">,</span> <span class="n">tsdt</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">save</span> <span class="o">==</span> <span class="s2">&quot;graphite&quot;</span><span class="p">:</span>
            <span class="c1"># Store data to database Graphite</span>
            <span class="c1">#database.store2graphite(vcsa, &quot;clib_sync&quot;, tsepoch, &quot;message&quot;, message, log, debug)</span>
            <span class="c1">#database.store2graphite(vcsa, &quot;clib_sync&quot;, tsepoch, &quot;libraries&quot;, libraries, log, debug)</span>
            <span class="c1">#database.store2graphite(vcsa, &quot;clib_sync&quot;, tsepoch, &quot;status&quot;, status, log, debug)</span>
            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[DEBUG] Graphite time series database does not support this type of metric!&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">log</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Graphite time series database does not support this type of metric!&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="rest_backup_status"><a class="viewcode-back" href="../../index.html#vcsa_monitor.__main__.rest_backup_status">[docs]</a><span class="k">def</span> <span class="nf">rest_backup_status</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="n">save</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Use rest method backup status and store result</span>

<span class="sd">    :param vcsa: name of a specific vCenter (fqdn)</span>
<span class="sd">    :type vcsa: str</span>
<span class="sd">    :param token: session id</span>
<span class="sd">    :type token: str</span>
<span class="sd">    :param save: store data to database InfluxDB or Graphite</span>
<span class="sd">    :type save: str</span>
<span class="sd">    :param log: enable log to file</span>
<span class="sd">    :type log: bool</span>
<span class="sd">    :param debug: enable debug</span>
<span class="sd">    :type debug: bool</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">backup</span><span class="o">.</span><span class="n">get_backup_status</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>
    <span class="n">tsepoch</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">tot_job</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">job_status</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">job_type</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">job_start_time</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
    <span class="n">job_end_time</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
    <span class="n">job_size</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>

    <span class="n">job_aging</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">tot_job</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[DEBUG] There is a backup job&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">log</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;There is a backup job&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">job_status</span> <span class="o">==</span> <span class="s2">&quot;SUCCEEDED&quot;</span><span class="p">:</span>
            <span class="n">datetimeFormat</span> <span class="o">=</span> <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">T%H:%M:%S.</span><span class="si">%f</span><span class="s1">Z&#39;</span>
            <span class="n">diff_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">tsepoch</span><span class="p">)</span> <span class="o">-</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">job_start_time</span><span class="p">,</span> <span class="n">datetimeFormat</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">diff_time</span><span class="o">.</span><span class="n">days</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">job_aging</span> <span class="o">=</span> <span class="mi">0</span>       <span class="c1"># 0 = recent</span>

                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[DEBUG] Backup aging: RECENT&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">log</span><span class="p">:</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Backup aging: RECENT&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">diff_time</span><span class="o">.</span><span class="n">days</span> <span class="o">&gt;=</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">diff_time</span><span class="o">.</span><span class="n">days</span> <span class="o">&lt;=</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">job_aging</span> <span class="o">=</span> <span class="mi">1</span>       <span class="c1"># 1 = stale</span>

                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[DEBUG] Backup aging: STALE&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">log</span><span class="p">:</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Backup aging: STALE&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">diff_time</span><span class="o">.</span><span class="n">days</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">job_aging</span> <span class="o">=</span> <span class="mi">2</span>       <span class="c1"># 2 = old</span>

                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[DEBUG] Backup aging: OLD&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">log</span><span class="p">:</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Backup aging: OLD&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">job_aging</span> <span class="o">=</span> <span class="mi">3</span>           <span class="c1"># 3 = error</span>

            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[DEBUG] Backup aging: ERROR&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">log</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Backup aging: ERROR&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">save</span> <span class="o">==</span> <span class="s2">&quot;influxdb&quot;</span><span class="p">:</span>
            <span class="c1"># Store data to database InfluxDB</span>
            <span class="n">tsdt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcfromtimestamp</span><span class="p">(</span><span class="n">tsepoch</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">T%H:%M:%S.000Z&quot;</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;job_status&quot;</span><span class="p">:</span> <span class="n">job_status</span><span class="p">,</span>
                <span class="s2">&quot;job_type&quot;</span><span class="p">:</span> <span class="n">job_type</span><span class="p">,</span>
                <span class="s2">&quot;job_start_time&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">job_start_time</span><span class="p">[:</span><span class="o">-</span><span class="mi">5</span><span class="p">])</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">),</span>
                <span class="s2">&quot;job_end_time&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">job_end_time</span><span class="p">[:</span><span class="o">-</span><span class="mi">5</span><span class="p">])</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">),</span>
                <span class="s2">&quot;job_size&quot;</span><span class="p">:</span> <span class="n">job_size</span><span class="p">,</span>
                <span class="s2">&quot;job_aging&quot;</span><span class="p">:</span> <span class="n">job_aging</span>
            <span class="p">}</span>
            <span class="n">database</span><span class="o">.</span><span class="n">store2influx</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="s2">&quot;backup_status&quot;</span><span class="p">,</span> <span class="n">tsdt</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">save</span> <span class="o">==</span> <span class="s2">&quot;graphite&quot;</span><span class="p">:</span>
            <span class="c1"># Store data to database Graphite</span>
            <span class="c1">#database.store2graphite(vcsa, &quot;backup_status&quot;, tsepoch, &quot;job_status&quot;, job_status, log, debug)</span>
            <span class="c1">#database.store2graphite(vcsa, &quot;backup_status&quot;, tsepoch, &quot;job_type&quot;, job_type, log, debug)</span>
            <span class="c1">#database.store2graphite(vcsa, &quot;backup_status&quot;, tsepoch, &quot;job_start_time&quot;, job_start_time[:-5], log, debug)</span>
            <span class="c1">#database.store2graphite(vcsa, &quot;backup_status&quot;, tsepoch, &quot;job_end_time&quot;, job_end_time[:-5], log, debug)</span>
            <span class="c1">#database.store2graphite(vcsa, &quot;backup_status&quot;, tsepoch, &quot;job_size&quot;, job_size, log, debug)</span>
            <span class="c1">#database.store2graphite(vcsa, &quot;backup_status&quot;, tsepoch, &quot;job_aging&quot;, job_aging, log, debug)</span>
            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[DEBUG] Graphite time series database does not support this type of metric!&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">log</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Graphite time series database does not support this type of metric!&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[DEBUG] There is no backup job&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">log</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;There is no backup job&quot;</span><span class="p">)</span>

        <span class="n">job_status</span> <span class="o">=</span> <span class="s2">&quot;ABSENT&quot;</span>
        <span class="n">job_type</span> <span class="o">=</span> <span class="s2">&quot;N/A&quot;</span>
        <span class="n">job_start_time</span> <span class="o">=</span> <span class="s2">&quot;N/A&quot;</span>
        <span class="n">job_end_time</span> <span class="o">=</span> <span class="s2">&quot;N/A&quot;</span>
        <span class="n">job_size</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">job_aging</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

        <span class="k">if</span> <span class="n">save</span> <span class="o">==</span> <span class="s2">&quot;influxdb&quot;</span><span class="p">:</span>
            <span class="c1"># Store data to database InfluxDB</span>
            <span class="n">tsdt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcfromtimestamp</span><span class="p">(</span><span class="n">tsepoch</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">T%H:%M:%S.000Z&quot;</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;job_status&quot;</span><span class="p">:</span> <span class="n">job_status</span><span class="p">,</span>
                <span class="s2">&quot;job_type&quot;</span><span class="p">:</span> <span class="n">job_type</span><span class="p">,</span>
                <span class="s2">&quot;job_start_time&quot;</span><span class="p">:</span> <span class="n">job_start_time</span><span class="p">,</span>
                <span class="s2">&quot;job_end_time&quot;</span><span class="p">:</span> <span class="n">job_end_time</span><span class="p">,</span>
                <span class="s2">&quot;job_size&quot;</span><span class="p">:</span> <span class="n">job_size</span><span class="p">,</span>
                <span class="s2">&quot;job_aging&quot;</span><span class="p">:</span> <span class="n">job_aging</span>
            <span class="p">}</span>
            <span class="n">database</span><span class="o">.</span><span class="n">store2influx</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="s2">&quot;backup_status&quot;</span><span class="p">,</span> <span class="n">tsdt</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">save</span> <span class="o">==</span> <span class="s2">&quot;graphite&quot;</span><span class="p">:</span>
            <span class="c1"># Store data to database Graphite</span>
            <span class="c1">#database.store2graphite(vcsa, &quot;backup_status&quot;, tsepoch, &quot;job_status&quot;, job_status, log, debug)</span>
            <span class="c1">#database.store2graphite(vcsa, &quot;backup_status&quot;, tsepoch, &quot;job_type&quot;, job_type, log, debug)</span>
            <span class="c1">#database.store2graphite(vcsa, &quot;backup_status&quot;, tsepoch, &quot;job_start_time&quot;, job_start_time, log, debug)</span>
            <span class="c1">#database.store2graphite(vcsa, &quot;backup_status&quot;, tsepoch, &quot;job_end_time&quot;, job_end_time, log, debug)</span>
            <span class="c1">#database.store2graphite(vcsa, &quot;backup_status&quot;, tsepoch, &quot;job_size&quot;, job_size, log, debug)</span>
            <span class="c1">#database.store2graphite(vcsa, &quot;backup_status&quot;, tsepoch, &quot;job_aging&quot;, job_aging, log, debug)</span>
            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[DEBUG] Graphite time series database does not support this type of metric!&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">log</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Graphite time series database does not support this type of metric!&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="rest_health_service"><a class="viewcode-back" href="../../index.html#vcsa_monitor.__main__.rest_health_service">[docs]</a><span class="k">def</span> <span class="nf">rest_health_service</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">save</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Use rest method health service and store result</span>

<span class="sd">    :param vcsa: name of a specific vCenter (fqdn)</span>
<span class="sd">    :type vcsa: str</span>
<span class="sd">    :param token: session id</span>
<span class="sd">    :type token: str</span>
<span class="sd">    :param method: set a specific method (value = srvc_all, srvc_content-library, srvc_pschealth,</span>
<span class="sd">                                            srvc_vcha, srvc_vmware-vpostgres, srvc_vmware-postgres-archiver,</span>
<span class="sd">                                            srvc_vpxd, srvc_vsan-health, srvc_vsphere-client, srvc_vsphere-ui)</span>
<span class="sd">    :type method: str</span>
<span class="sd">    :param save: store data to database InfluxDB or Graphite</span>
<span class="sd">    :type save: str</span>
<span class="sd">    :param log: enable log to file</span>
<span class="sd">    :type log: bool</span>
<span class="sd">    :param debug: enable debug</span>
<span class="sd">    :type debug: bool</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;srvc_all&quot;</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">vmon</span><span class="o">.</span><span class="n">get_health_service</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="s2">&quot;ALL&quot;</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;srvc_content-library&quot;</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">vmon</span><span class="o">.</span><span class="n">get_health_service</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="s2">&quot;content-library&quot;</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;srvc_pschealth&quot;</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">vmon</span><span class="o">.</span><span class="n">get_health_service</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="s2">&quot;pschealth&quot;</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;srvc_vcha&quot;</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">vmon</span><span class="o">.</span><span class="n">get_health_service</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="s2">&quot;vcha&quot;</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;srvc_vmware-vpostgres&quot;</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">vmon</span><span class="o">.</span><span class="n">get_health_service</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="s2">&quot;vmware-vpostgres&quot;</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;srvc_vmware-postgres-archiver&quot;</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">vmon</span><span class="o">.</span><span class="n">get_health_service</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="s2">&quot;vmware-postgres-archiver&quot;</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;srvc_vpxd&quot;</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">vmon</span><span class="o">.</span><span class="n">get_health_service</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="s2">&quot;vpxd&quot;</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;srvc_vsan-health&quot;</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">vmon</span><span class="o">.</span><span class="n">get_health_service</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="s2">&quot;vsan-health&quot;</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;srvc_vsphere-client&quot;</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">vmon</span><span class="o">.</span><span class="n">get_health_service</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="s2">&quot;vsphere-client&quot;</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;srvc_vsphere-ui&quot;</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">vmon</span><span class="o">.</span><span class="n">get_health_service</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="s2">&quot;vsphere-ui&quot;</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>

    <span class="n">tsepoch</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">services</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">save</span> <span class="o">==</span> <span class="s2">&quot;influxdb&quot;</span><span class="p">:</span>
        <span class="c1"># Store data to database InfluxDB</span>
        <span class="n">tsdt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcfromtimestamp</span><span class="p">(</span><span class="n">tsepoch</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">T%H:%M:%S.000Z&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">services</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="n">value</span>
            <span class="p">}</span>
            <span class="n">srvc_name</span> <span class="o">=</span> <span class="s2">&quot;srvc_&quot;</span> <span class="o">+</span> <span class="n">key</span>
            <span class="n">database</span><span class="o">.</span><span class="n">store2influx</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="n">srvc_name</span><span class="p">,</span> <span class="n">tsdt</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">save</span> <span class="o">==</span> <span class="s2">&quot;graphite&quot;</span><span class="p">:</span>
        <span class="c1"># Store data to database Graphite</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">services</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">srvc_name</span> <span class="o">=</span> <span class="s2">&quot;srvc_&quot;</span> <span class="o">+</span> <span class="n">key</span>
            <span class="n">database</span><span class="o">.</span><span class="n">store2graphite</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="n">srvc_name</span><span class="p">,</span> <span class="n">tsepoch</span><span class="p">,</span> <span class="s2">&quot;status&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span></div>


<div class="viewcode-block" id="rest_available_updates"><a class="viewcode-back" href="../../index.html#vcsa_monitor.__main__.rest_available_updates">[docs]</a><span class="k">def</span> <span class="nf">rest_available_updates</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="n">save</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Use rest method available updates and store result</span>

<span class="sd">    :param vcsa: name of a specific vCenter (fqdn)</span>
<span class="sd">    :type vcsa: str</span>
<span class="sd">    :param token: session id</span>
<span class="sd">    :type token: str</span>
<span class="sd">    :param save: store data to database InfluxDB or Graphite</span>
<span class="sd">    :type save: str</span>
<span class="sd">    :param log: enable log to file</span>
<span class="sd">    :type log: bool</span>
<span class="sd">    :param debug: enable debug</span>
<span class="sd">    :type debug: bool</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">updates</span><span class="o">.</span><span class="n">get_available_updates</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>
    <span class="n">tsepoch</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">save</span> <span class="o">==</span> <span class="s2">&quot;influxdb&quot;</span><span class="p">:</span>
        <span class="c1"># Store data to database InfluxDB</span>
        <span class="n">tsdt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcfromtimestamp</span><span class="p">(</span><span class="n">tsepoch</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">T%H:%M:%S.000Z&quot;</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;updates&quot;</span><span class="p">:</span> <span class="n">value</span>
        <span class="p">}</span>
        <span class="n">database</span><span class="o">.</span><span class="n">store2influx</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="s2">&quot;available_updates&quot;</span><span class="p">,</span> <span class="n">tsdt</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">save</span> <span class="o">==</span> <span class="s2">&quot;graphite&quot;</span><span class="p">:</span>
        <span class="c1"># Store data to database Graphite</span>
        <span class="n">database</span><span class="o">.</span><span class="n">store2graphite</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="s2">&quot;available_updates&quot;</span><span class="p">,</span> <span class="n">tsepoch</span><span class="p">,</span> <span class="s2">&quot;updates&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span></div>


<div class="viewcode-block" id="rest_vcha_active_node"><a class="viewcode-back" href="../../index.html#vcsa_monitor.__main__.rest_vcha_active_node">[docs]</a><span class="k">def</span> <span class="nf">rest_vcha_active_node</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="n">save</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Use rest method vcha active node and store result</span>

<span class="sd">    :param vcsa: name of a specific vCenter (fqdn)</span>
<span class="sd">    :type vcsa: str</span>
<span class="sd">    :param token: session id</span>
<span class="sd">    :type token: str</span>
<span class="sd">    :param save: store data to database InfluxDB or Graphite</span>
<span class="sd">    :type save: str</span>
<span class="sd">    :param log: enable log to file</span>
<span class="sd">    :type log: bool</span>
<span class="sd">    :param debug: enable debug</span>
<span class="sd">    :type debug: bool</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">vmon</span><span class="o">.</span><span class="n">get_health_service</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="s2">&quot;vcha&quot;</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>
    <span class="n">tsepoch</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">health_srvc</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">value</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">health_srvc</span><span class="p">[</span><span class="s2">&quot;vcha&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>  <span class="c1"># Service STOPPED</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[DEBUG] Service VCHA is stopped!&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">log</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Service VCHA is stopped!&quot;</span><span class="p">)</span>

        <span class="n">value</span> <span class="o">=</span> <span class="mi">3</span>       <span class="c1"># 1 = PRIMARY ONLINE, 2 = SECONDARY ONLINE, 3 = HA OFF</span>

        <span class="k">if</span> <span class="n">save</span> <span class="o">==</span> <span class="s2">&quot;influxdb&quot;</span><span class="p">:</span>
            <span class="c1"># Store data to database InfluxDB</span>
            <span class="n">tsdt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcfromtimestamp</span><span class="p">(</span><span class="n">tsepoch</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">T%H:%M:%S.000Z&quot;</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;node&quot;</span><span class="p">:</span> <span class="n">value</span>
            <span class="p">}</span>
            <span class="n">database</span><span class="o">.</span><span class="n">store2influx</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="s2">&quot;vcha_active_node&quot;</span><span class="p">,</span> <span class="n">tsdt</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">save</span> <span class="o">==</span> <span class="s2">&quot;graphite&quot;</span><span class="p">:</span>
            <span class="c1"># Store data to database Graphite</span>
            <span class="n">database</span><span class="o">.</span><span class="n">store2graphite</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="s2">&quot;vcha_active_node&quot;</span><span class="p">,</span> <span class="n">tsepoch</span><span class="p">,</span> <span class="s2">&quot;node&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Get VCHA active node (return value: IP of VCHA active node)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">vcha</span><span class="o">.</span><span class="n">get_vcha_active_node</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>
        <span class="n">tsepoch</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">vcha_config</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">ha_ip</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">vcha_config</span> <span class="o">==</span> <span class="s2">&quot;present&quot;</span><span class="p">:</span>
            <span class="n">found</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">config</span><span class="o">.</span><span class="n">map_vcha</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="n">vcsa</span><span class="p">:</span>
                    <span class="n">found</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[DEBUG] Heartbeat stored mapping for VCSA </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">vcsa</span><span class="p">)</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[DEBUG] Heartbeat IP of VCHA node 1 (Primary): </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">config</span><span class="o">.</span><span class="n">map_vcha</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;Primary&quot;</span><span class="p">])</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[DEBUG] Heartbeat IP of VCHA node 2 (Secondary): </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">config</span><span class="o">.</span><span class="n">map_vcha</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;Secondary&quot;</span><span class="p">])</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[DEBUG] Heartbeat IP of VCHA node 3 (Witness): </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">config</span><span class="o">.</span><span class="n">map_vcha</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;Witness&quot;</span><span class="p">])</span>

                    <span class="k">if</span> <span class="n">log</span><span class="p">:</span>
                        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Heartbeat stored mapping for VCSA </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">vcsa</span><span class="p">)</span>
                        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Heartbeat IP of VCHA node 1 (Primary): </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">config</span><span class="o">.</span><span class="n">map_vcha</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;Primary&quot;</span><span class="p">])</span>
                        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Heartbeat IP of VCHA node 2 (Secondary): </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">config</span><span class="o">.</span><span class="n">map_vcha</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;Secondary&quot;</span><span class="p">])</span>
                        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Heartbeat IP of VCHA node 3 (Witness): </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">config</span><span class="o">.</span><span class="n">map_vcha</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;Witness&quot;</span><span class="p">])</span>

                    <span class="k">if</span> <span class="n">ha_ip</span> <span class="o">==</span> <span class="n">config</span><span class="o">.</span><span class="n">map_vcha</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;Primary&quot;</span><span class="p">]:</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="mi">1</span>       <span class="c1"># 1 = PRIMARY ONLINE, 2 = SECONDARY ONLINE, 3 = HA OFF</span>

                        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[DEBUG] VCHA Node 1 (Primary) is now online!&quot;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">log</span><span class="p">:</span>
                            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;VCHA Node 1 (Primary) is now online!&quot;</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">ha_ip</span> <span class="o">==</span> <span class="n">config</span><span class="o">.</span><span class="n">map_vcha</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;Secondary&quot;</span><span class="p">]:</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="mi">2</span>       <span class="c1"># 1 = PRIMARY ONLINE, 2 = SECONDARY ONLINE, 3 = HA OFF</span>

                        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[DEBUG] VCHA Node 2 (Secondary) is now online!&quot;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">log</span><span class="p">:</span>
                            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;VCHA Node 2 (Secondary) is now online!&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">found</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[ERROR] VCSA not found in heartbeat mapping!&quot;</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">log</span><span class="p">:</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;VCSA not found in heartbeat mapping!&quot;</span><span class="p">)</span>

                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">vcha_config</span> <span class="o">==</span> <span class="s2">&quot;absent&quot;</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="mi">3</span>               <span class="c1"># 1 = PRIMARY ONLINE, 2 = SECONDARY ONLINE, 3 = HA OFF</span>

        <span class="k">if</span> <span class="n">save</span> <span class="o">==</span> <span class="s2">&quot;influxdb&quot;</span><span class="p">:</span>
            <span class="c1"># Store data to database InfluxDB</span>
            <span class="n">tsdt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcfromtimestamp</span><span class="p">(</span><span class="n">tsepoch</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">T%H:%M:%S.000Z&quot;</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;node&quot;</span><span class="p">:</span> <span class="n">value</span>
            <span class="p">}</span>
            <span class="n">database</span><span class="o">.</span><span class="n">store2influx</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="s2">&quot;vcha_active_node&quot;</span><span class="p">,</span> <span class="n">tsdt</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">save</span> <span class="o">==</span> <span class="s2">&quot;graphite&quot;</span><span class="p">:</span>
            <span class="c1"># Store data to database Graphite</span>
            <span class="n">database</span><span class="o">.</span><span class="n">store2graphite</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="s2">&quot;vcha_active_node&quot;</span><span class="p">,</span> <span class="n">tsepoch</span><span class="p">,</span> <span class="s2">&quot;node&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span></div>


<div class="viewcode-block" id="rest_vcha_health_cluster"><a class="viewcode-back" href="../../index.html#vcsa_monitor.__main__.rest_vcha_health_cluster">[docs]</a><span class="k">def</span> <span class="nf">rest_vcha_health_cluster</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="n">save</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Use rest method vcha health cluster and store result</span>

<span class="sd">    :param vcsa: name of a specific vCenter (fqdn)</span>
<span class="sd">    :type vcsa: str</span>
<span class="sd">    :param token: session id</span>
<span class="sd">    :type token: str</span>
<span class="sd">    :param save: store data to database InfluxDB or Graphite</span>
<span class="sd">    :type save: str</span>
<span class="sd">    :param log: enable log to file</span>
<span class="sd">    :type log: bool</span>
<span class="sd">    :param debug: enable debug</span>
<span class="sd">    :type debug: bool</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">vcha</span><span class="o">.</span><span class="n">get_vcha_health_cluster</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>
    <span class="n">tsepoch</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">config_state</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">cluster_mode</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">health_state</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">manual_failover_allowed</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
    <span class="n">auto_failover_allowed</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
    <span class="n">health_warnings</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>
    <span class="n">primary_role</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span>
    <span class="n">secondary_role</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span>
    <span class="n">primary_state</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span>
    <span class="n">secondary_state</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span>
    <span class="n">witness_state</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">config_state</span> <span class="o">==</span> <span class="s2">&quot;NOTCONFIGURED&quot;</span> <span class="ow">or</span> <span class="n">config_state</span> <span class="o">==</span> <span class="s2">&quot;--&quot;</span><span class="p">:</span>
        <span class="n">cluster_mode</span> <span class="o">=</span> <span class="mi">3</span>                    <span class="c1"># 0 = ENABLED, 1 = MAINTENANCE, 2 = DISABLED, 3 = NOT_CONFIGURED</span>
        <span class="n">health_state</span> <span class="o">=</span> <span class="mi">3</span>                    <span class="c1"># 0 = HEALTHY, 1 = HEALTHY_WITH_WARNINGS, 2 = DEGRADED, 3 = NOT_CONFIGURED</span>
        <span class="n">manual_failover_allowed</span> <span class="o">=</span> <span class="mi">2</span>         <span class="c1"># UNDEFINED FAILOVER: manual_failover_allowed = 2, auto_failover_allowed = 2</span>
        <span class="n">auto_failover_allowed</span> <span class="o">=</span> <span class="mi">2</span>           <span class="c1"># UNDEFINED FAILOVER: manual_failover_allowed = 2, auto_failover_allowed = 2</span>
        <span class="n">primary_role</span> <span class="o">=</span> <span class="mi">2</span>                    <span class="c1"># UNDEFINED ROLE: primary_role = 2, secondary_role = 2</span>
        <span class="n">secondary_role</span> <span class="o">=</span> <span class="mi">2</span>                  <span class="c1"># UNDEFINED ROLE: primary_role = 2, secondary_role = 2</span>
        <span class="n">primary_state</span> <span class="o">=</span> <span class="mi">2</span>                   <span class="c1"># UNDEFINED STATE: primary_state = 2, secondary_state = 2, witness_state = 2</span>
        <span class="n">secondary_state</span> <span class="o">=</span> <span class="mi">2</span>                 <span class="c1"># UNDEFINED STATE: primary_state = 2, secondary_state = 2, witness_state = 2</span>
        <span class="n">witness_state</span> <span class="o">=</span> <span class="mi">2</span>                   <span class="c1"># UNDEFINED STATE: primary_state = 2, secondary_state = 2, witness_state = 2</span>

    <span class="k">elif</span> <span class="n">config_state</span> <span class="o">==</span> <span class="s2">&quot;CONFIGURED&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">cluster_mode</span> <span class="o">==</span> <span class="s2">&quot;ENABLED&quot;</span><span class="p">:</span>
            <span class="n">cluster_mode</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">elif</span> <span class="n">cluster_mode</span> <span class="o">==</span> <span class="s2">&quot;MAINTENANCE&quot;</span><span class="p">:</span>
            <span class="n">cluster_mode</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">cluster_mode</span> <span class="o">==</span> <span class="s2">&quot;DISABLED&quot;</span><span class="p">:</span>
            <span class="n">cluster_mode</span> <span class="o">=</span> <span class="mi">2</span>

        <span class="k">if</span> <span class="n">health_state</span> <span class="o">==</span> <span class="s2">&quot;HEALTHY&quot;</span><span class="p">:</span>
            <span class="n">health_state</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">elif</span> <span class="n">health_state</span> <span class="o">==</span> <span class="s2">&quot;HEALTHY_WITH_WARNINGS&quot;</span><span class="p">:</span>
            <span class="n">health_state</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">health_state</span> <span class="o">==</span> <span class="s2">&quot;DEGRADED&quot;</span><span class="p">:</span>
            <span class="n">health_state</span> <span class="o">=</span> <span class="mi">2</span>

        <span class="n">manual_failover_allowed</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">manual_failover_allowed</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">auto_failover_allowed</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">auto_failover_allowed</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">primary_role</span> <span class="o">==</span> <span class="s2">&quot;ACTIVE&quot;</span><span class="p">:</span>
            <span class="n">primary_role</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">primary_role</span> <span class="o">==</span> <span class="s2">&quot;PASSIVE&quot;</span><span class="p">:</span>
            <span class="n">primary_role</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="n">secondary_role</span> <span class="o">==</span> <span class="s2">&quot;ACTIVE&quot;</span><span class="p">:</span>
            <span class="n">secondary_role</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">secondary_role</span> <span class="o">==</span> <span class="s2">&quot;PASSIVE&quot;</span><span class="p">:</span>
            <span class="n">secondary_role</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="n">primary_state</span> <span class="o">==</span> <span class="s2">&quot;UP&quot;</span><span class="p">:</span>
            <span class="n">primary_state</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">primary_state</span> <span class="o">==</span> <span class="s2">&quot;DOWN&quot;</span><span class="p">:</span>
            <span class="n">primary_state</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="n">secondary_state</span> <span class="o">==</span> <span class="s2">&quot;UP&quot;</span><span class="p">:</span>
            <span class="n">secondary_state</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">secondary_state</span> <span class="o">==</span> <span class="s2">&quot;DOWN&quot;</span><span class="p">:</span>
            <span class="n">secondary_state</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="n">witness_state</span> <span class="o">==</span> <span class="s2">&quot;UP&quot;</span><span class="p">:</span>
            <span class="n">witness_state</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">witness_state</span> <span class="o">==</span> <span class="s2">&quot;DOWN&quot;</span><span class="p">:</span>
            <span class="n">witness_state</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">if</span> <span class="n">save</span> <span class="o">==</span> <span class="s2">&quot;influxdb&quot;</span><span class="p">:</span>
        <span class="c1"># Store data to database InfluxDB</span>
        <span class="n">tsdt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcfromtimestamp</span><span class="p">(</span><span class="n">tsepoch</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">T%H:%M:%S.000Z&quot;</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;cluster_mode&quot;</span><span class="p">:</span> <span class="n">cluster_mode</span><span class="p">,</span>
                <span class="s2">&quot;health_state&quot;</span><span class="p">:</span> <span class="n">health_state</span><span class="p">,</span>
                <span class="s2">&quot;manual_failover_allowed&quot;</span><span class="p">:</span> <span class="n">manual_failover_allowed</span><span class="p">,</span>
                <span class="s2">&quot;auto_failover_allowed&quot;</span><span class="p">:</span> <span class="n">auto_failover_allowed</span><span class="p">,</span>
                <span class="s2">&quot;primary_role&quot;</span><span class="p">:</span> <span class="n">primary_role</span><span class="p">,</span>
                <span class="s2">&quot;secondary_role&quot;</span><span class="p">:</span> <span class="n">secondary_role</span><span class="p">,</span>
                <span class="s2">&quot;primary_state&quot;</span><span class="p">:</span> <span class="n">primary_state</span><span class="p">,</span>
                <span class="s2">&quot;secondary_state&quot;</span><span class="p">:</span> <span class="n">secondary_state</span><span class="p">,</span>
                <span class="s2">&quot;witness_state&quot;</span><span class="p">:</span> <span class="n">witness_state</span>
        <span class="p">}</span>
        <span class="n">database</span><span class="o">.</span><span class="n">store2influx</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="s2">&quot;vcha_health_cluster&quot;</span><span class="p">,</span> <span class="n">tsdt</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">save</span> <span class="o">==</span> <span class="s2">&quot;graphite&quot;</span><span class="p">:</span>
        <span class="c1"># Store data to database Graphite</span>
        <span class="n">database</span><span class="o">.</span><span class="n">store2graphite</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="s2">&quot;vcha_health_cluster&quot;</span><span class="p">,</span> <span class="n">tsepoch</span><span class="p">,</span> <span class="s2">&quot;cluster_mode&quot;</span><span class="p">,</span> <span class="n">cluster_mode</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>
        <span class="n">database</span><span class="o">.</span><span class="n">store2graphite</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="s2">&quot;vcha_health_cluster&quot;</span><span class="p">,</span> <span class="n">tsepoch</span><span class="p">,</span> <span class="s2">&quot;health_state&quot;</span><span class="p">,</span> <span class="n">health_state</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>
        <span class="n">database</span><span class="o">.</span><span class="n">store2graphite</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="s2">&quot;vcha_health_cluster&quot;</span><span class="p">,</span> <span class="n">tsepoch</span><span class="p">,</span> <span class="s2">&quot;manual_failover_allowed&quot;</span><span class="p">,</span> <span class="n">manual_failover_allowed</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>
        <span class="n">database</span><span class="o">.</span><span class="n">store2graphite</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="s2">&quot;vcha_health_cluster&quot;</span><span class="p">,</span> <span class="n">tsepoch</span><span class="p">,</span> <span class="s2">&quot;auto_failover_allowed&quot;</span><span class="p">,</span> <span class="n">auto_failover_allowed</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>
        <span class="n">database</span><span class="o">.</span><span class="n">store2graphite</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="s2">&quot;vcha_health_cluster&quot;</span><span class="p">,</span> <span class="n">tsepoch</span><span class="p">,</span> <span class="s2">&quot;primary_role&quot;</span><span class="p">,</span> <span class="n">primary_role</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>
        <span class="n">database</span><span class="o">.</span><span class="n">store2graphite</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="s2">&quot;vcha_health_cluster&quot;</span><span class="p">,</span> <span class="n">tsepoch</span><span class="p">,</span> <span class="s2">&quot;secondary_role&quot;</span><span class="p">,</span> <span class="n">secondary_role</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>
        <span class="n">database</span><span class="o">.</span><span class="n">store2graphite</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="s2">&quot;vcha_health_cluster&quot;</span><span class="p">,</span> <span class="n">tsepoch</span><span class="p">,</span> <span class="s2">&quot;primary_state&quot;</span><span class="p">,</span> <span class="n">primary_state</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>
        <span class="n">database</span><span class="o">.</span><span class="n">store2graphite</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="s2">&quot;vcha_health_cluster&quot;</span><span class="p">,</span> <span class="n">tsepoch</span><span class="p">,</span> <span class="s2">&quot;secondary_state&quot;</span><span class="p">,</span> <span class="n">secondary_state</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>
        <span class="n">database</span><span class="o">.</span><span class="n">store2graphite</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="s2">&quot;vcha_health_cluster&quot;</span><span class="p">,</span> <span class="n">tsepoch</span><span class="p">,</span> <span class="s2">&quot;witness_state&quot;</span><span class="p">,</span> <span class="n">witness_state</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">health_warnings</span> <span class="o">!=</span> <span class="s2">&quot;--&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[WARNING] There are warning messages!&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">log</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;There are warning messages!&quot;</span><span class="p">)</span>

        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">health_warnings</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">message</span> <span class="o">=</span> <span class="n">elem</span><span class="p">[</span><span class="s2">&quot;error&quot;</span><span class="p">][</span><span class="s2">&quot;default_message&quot;</span><span class="p">]</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;--&quot;</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">additional_information</span> <span class="o">=</span> <span class="n">elem</span><span class="p">[</span><span class="s2">&quot;recommendation&quot;</span><span class="p">][</span><span class="s2">&quot;default_message&quot;</span><span class="p">]</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">additional_information</span> <span class="o">=</span> <span class="s2">&quot;--&quot;</span>

            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[DEBUG] Message: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">message</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[DEBUG] Additional Information: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">additional_information</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">log</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Message: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">message</span><span class="p">)</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Additional Information: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">additional_information</span><span class="p">)</span>

            <span class="n">tsepoch</span> <span class="o">+=</span> <span class="n">count</span>
            <span class="k">if</span> <span class="n">save</span> <span class="o">==</span> <span class="s2">&quot;influxdb&quot;</span><span class="p">:</span>
                <span class="c1"># Store data to database InfluxDB</span>
                <span class="n">tsdt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcfromtimestamp</span><span class="p">(</span><span class="n">tsepoch</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">T%H:%M:%S.000Z&quot;</span><span class="p">)</span>
                <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="n">message</span><span class="p">,</span>
                    <span class="s2">&quot;additional_information&quot;</span><span class="p">:</span> <span class="n">additional_information</span>
                <span class="p">}</span>
                <span class="n">database</span><span class="o">.</span><span class="n">store2influx</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="s2">&quot;vcha_cluster_message&quot;</span><span class="p">,</span> <span class="n">tsdt</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">save</span> <span class="o">==</span> <span class="s2">&quot;graphite&quot;</span><span class="p">:</span>
                <span class="c1"># Store data to database Graphite</span>
                <span class="c1">#database.store2graphite(vcsa, &quot;vcha_cluster_message&quot;, tsepoch, &quot;message&quot;, message, log, debug)</span>
                <span class="c1">#database.store2graphite(vcsa, &quot;vcha_cluster_message&quot;, tsepoch, &quot;additional_information&quot;, additional_information, log, debug)</span>
                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[DEBUG] Graphite time series database does not support this type of metric!&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">log</span><span class="p">:</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Graphite time series database does not support this type of metric!&quot;</span><span class="p">)</span>

            <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[DEBUG] There are no warning messages&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">log</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;There are no warning messages&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="call_method"><a class="viewcode-back" href="../../index.html#vcsa_monitor.__main__.call_method">[docs]</a><span class="k">def</span> <span class="nf">call_method</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="n">save</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Call method to get a specific metric</span>

<span class="sd">    :param vcsa: name of a specific vCenter (fqdn)</span>
<span class="sd">    :type vcsa: str</span>
<span class="sd">    :param token: session id</span>
<span class="sd">    :type token: str</span>
<span class="sd">    :param method: set a specific method</span>
<span class="sd">    :type method: str</span>
<span class="sd">    :param function: set a specific metric function</span>
<span class="sd">    :type function: str</span>
<span class="sd">    :param save: store data to database</span>
<span class="sd">    :type save: bool</span>
<span class="sd">    :param log: enable log to file</span>
<span class="sd">    :type log: bool</span>
<span class="sd">    :param debug: enable debug</span>
<span class="sd">    :type debug: bool</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;version&quot;</span><span class="p">:</span>
        <span class="n">rest_version</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="n">save</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;uptime&quot;</span><span class="p">:</span>
        <span class="n">rest_uptime</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="n">save</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;health_load&quot;</span> <span class="ow">or</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;health_memory&quot;</span> <span class="ow">or</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;health_storage&quot;</span>\
            <span class="ow">or</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;health_swap&quot;</span> <span class="ow">or</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;health_system&quot;</span> <span class="ow">or</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;health_softwarepackages&quot;</span>\
            <span class="ow">or</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;health_databasestorage&quot;</span> <span class="ow">or</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;health_applmgmt&quot;</span><span class="p">:</span>
        <span class="n">rest_health</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">save</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;cpu_util&quot;</span> <span class="ow">or</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;mem_usage&quot;</span><span class="p">:</span>
        <span class="n">rest_cpu_mem_usage</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="n">save</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;systemload&quot;</span><span class="p">:</span>
        <span class="n">rest_systemload</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="n">save</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;disk_latencyrate&quot;</span> <span class="ow">or</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;disk_readrate&quot;</span> <span class="ow">or</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;disk_writerate&quot;</span><span class="p">:</span>
        <span class="n">rest_disk_performance</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="n">save</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;rx_activity_eth0&quot;</span> <span class="ow">or</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;rx_activity_eth1&quot;</span> <span class="ow">or</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;rx_packetRate_eth0&quot;</span>\
            <span class="ow">or</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;rx_packetRate_eth1&quot;</span> <span class="ow">or</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;rx_drop_eth0&quot;</span> <span class="ow">or</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;rx_drop_eth1&quot;</span>\
            <span class="ow">or</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;rx_error_eth0&quot;</span> <span class="ow">or</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;rx_error_eth1&quot;</span> <span class="ow">or</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;tx_activity_eth0&quot;</span>\
            <span class="ow">or</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;tx_activity_eth1&quot;</span> <span class="ow">or</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;tx_packetRate_eth0&quot;</span> <span class="ow">or</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;tx_packetRate_eth1&quot;</span>\
            <span class="ow">or</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;tx_drop_eth0&quot;</span> <span class="ow">or</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;tx_drop_eth1&quot;</span> <span class="ow">or</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;tx_error_eth0&quot;</span>\
            <span class="ow">or</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;tx_error_eth1&quot;</span><span class="p">:</span>
        <span class="n">rest_network_performance</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="n">save</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;fs_root&quot;</span> <span class="ow">or</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;fs_swap&quot;</span> <span class="ow">or</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;fs_boot&quot;</span> <span class="ow">or</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;fs_core&quot;</span>\
            <span class="ow">or</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;fs_log&quot;</span> <span class="ow">or</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;fs_db&quot;</span> <span class="ow">or</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;fs_dblog&quot;</span> <span class="ow">or</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;fs_seat&quot;</span>\
            <span class="ow">or</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;fs_archive&quot;</span> <span class="ow">or</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;fs_updatemgr&quot;</span> <span class="ow">or</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;fs_imagebuilder&quot;</span>\
            <span class="ow">or</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;fs_autodeploy&quot;</span> <span class="ow">or</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;fs_netdump&quot;</span> <span class="ow">or</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;fs_lifecycle&quot;</span>\
            <span class="ow">or</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;fs_vtsdb&quot;</span> <span class="ow">or</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;fs_vtsdblog&quot;</span><span class="p">:</span>
        <span class="n">rest_filesystem_usage</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="n">save</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;content_library&quot;</span><span class="p">:</span>
        <span class="n">rest_content_library</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="n">save</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;backup_status&quot;</span><span class="p">:</span>
        <span class="n">rest_backup_status</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="n">save</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;srvc_all&quot;</span> <span class="ow">or</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;srvc_content-library&quot;</span> <span class="ow">or</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;srvc_pschealth&quot;</span>\
            <span class="ow">or</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;srvc_vcha&quot;</span> <span class="ow">or</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;srvc_vmware-vpostgres&quot;</span> <span class="ow">or</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;srvc_vmware-postgres-archiver&quot;</span>\
            <span class="ow">or</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;srvc_vpxd&quot;</span> <span class="ow">or</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;srvc_vsan-health&quot;</span> <span class="ow">or</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;srvc_vsphere-client&quot;</span>\
            <span class="ow">or</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;srvc_vsphere-ui&quot;</span><span class="p">:</span>
        <span class="n">rest_health_service</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">save</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;available_updates&quot;</span><span class="p">:</span>
        <span class="n">rest_available_updates</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="n">save</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;vcha_active_node&quot;</span><span class="p">:</span>
        <span class="n">rest_vcha_active_node</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="n">save</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;vcha_health_cluster&quot;</span><span class="p">:</span>
        <span class="n">rest_vcha_health_cluster</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="n">save</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span></div>


<span class="c1"># Main</span>
<div class="viewcode-block" id="main"><a class="viewcode-back" href="../../index.html#vcsa_monitor.__main__.main">[docs]</a><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">arguments</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">options</span><span class="p">()</span>

    <span class="n">vcsa</span> <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">password</span> <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">method</span> <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">function</span> <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
    <span class="n">checklist</span> <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
    <span class="n">save</span> <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>
    <span class="n">debug</span> <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span>
    <span class="n">log</span> <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">checklist</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">check_list</span><span class="p">[</span><span class="n">vcsa</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[DEBUG] VCSA have the definition of the checklist.&quot;</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">log</span><span class="p">:</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;VCSA have the definition of the checklist.&quot;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[DEBUG] VCSA does not have the definition of the checklist. &quot;</span> \
                      <span class="s2">&quot;Add the definition in the &#39;config.py&#39; file, to the &#39;check_list&#39; variable.&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">log</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;VCSA does not have the definition of the checklist.&quot;</span><span class="p">)</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Add the definition in the &#39;config.py&#39; file, to the &#39;check_list&#39; variable.&quot;</span><span class="p">)</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;-- Finish --------------------------------------------------------&quot;</span><span class="p">)</span>

            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Get token session</span>
        <span class="n">session_id</span> <span class="o">=</span> <span class="n">authentication</span><span class="o">.</span><span class="n">get_session</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">session_id</span> <span class="o">==</span> <span class="s2">&quot;failed&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[DEBUG] REST API Status: FAILED&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">log</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;REST API Status: FAILED&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
                <span class="n">save_restapi_health</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">save</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>        <span class="c1"># status = 0 (FAILED)</span>
            <span class="k">if</span> <span class="n">log</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;-- Finish --------------------------------------------------------&quot;</span><span class="p">)</span>

            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[DEBUG] REST API Status: OK&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">log</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;REST API Status: OK&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
                <span class="n">save_restapi_health</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">save</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>        <span class="c1"># status = 1 (OK)</span>

        <span class="k">for</span> <span class="n">appliance</span> <span class="ow">in</span> <span class="n">config</span><span class="o">.</span><span class="n">check_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">appliance</span> <span class="o">==</span> <span class="n">vcsa</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">config</span><span class="o">.</span><span class="n">check_list</span><span class="p">[</span><span class="n">appliance</span><span class="p">]:</span>
                    <span class="n">keys_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">elem</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                    <span class="n">method</span> <span class="o">=</span> <span class="n">keys_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">function</span> <span class="o">=</span> <span class="n">elem</span><span class="p">[</span><span class="n">method</span><span class="p">]</span>
                    <span class="n">call_method</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="n">session_id</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="n">save</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>

        <span class="c1"># Delete token session</span>
        <span class="n">authentication</span><span class="o">.</span><span class="n">del_session</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="n">session_id</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">log</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;-- Finish --------------------------------------------------------&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Get token session</span>
        <span class="n">session_id</span> <span class="o">=</span> <span class="n">authentication</span><span class="o">.</span><span class="n">get_session</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">session_id</span> <span class="o">==</span> <span class="s2">&quot;failed&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[DEBUG] REST API Status: FAILED&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">log</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;REST API Status: FAILED&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
                <span class="n">save_restapi_health</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">save</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>        <span class="c1"># status = 0 (FAILED)</span>
            <span class="k">if</span> <span class="n">log</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;-- Finish --------------------------------------------------------&quot;</span><span class="p">)</span>

            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[DEBUG] REST API Status: OK&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">log</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;REST API Status: OK&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
                <span class="n">save_restapi_health</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">save</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>        <span class="c1"># status = 1 (OK)</span>

        <span class="n">call_method</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="n">session_id</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="n">save</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>

        <span class="c1"># Delete token session</span>
        <span class="n">authentication</span><span class="o">.</span><span class="n">del_session</span><span class="p">(</span><span class="n">vcsa</span><span class="p">,</span> <span class="n">session_id</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">log</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;-- Finish --------------------------------------------------------&quot;</span><span class="p">)</span></div>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">VCSA REST API Monitoring stable 2.0.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2023, Danilo Cilento (GPLv3).
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.5.
    </div>
  </body>
</html>